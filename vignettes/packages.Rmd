---
title: "Using S7 in a package"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{packages}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(S7)
```

We recommend that you run `external_methods_register()` in your `.onLoad()`:

```{r}
.onLoad <- function(...) {
  S7::external_methods_register()
}
```

This is S7's way of registering methods, rather than using export directives in your `NAMESPACE` like S3 and S4 do.
This is only strictly necessary if registering methods for external, S3, or S4 generics, but there's no harm in adding it and it ensures that you won't forget later.
(And if you're not importing S7 into your namespace it will quiet an `R CMD check` `NOTE`.`)`

## Documentation

If you want users to create instances of your class, you will need to export the class constructor.
The constructor is a function, so that means that you will also need to document the arguments, which (unless you have customised the constructor) will be the properties of the class.

You should document generics like regular functions (since they are!).
We plan to provide a function dynaically that lists all methods available for the generic (track progress at <https://github.com/RConsortium/OOP-WG/issues/167>).

We don't currently have any recommendations on documenting methods.

## Backward compatibility

If you are using S7 in a package *and* you want your package to maintain compatibility with R before 4.3.0, be aware that `` base::`@` `` does not work with S7 properties.
We provide two workarounds:

-   Use `S7::prop()` instead of `@`.

-   Alternatively, make an S7-aware `@` available to your package with a custom `NAMESPACE` directive and `.onAttach()` like this:

    ``` r
    # enable usage of <S7_object>@name in package code
    #' @rawNamespace if (getRversion() < "4.3.0") importFrom("S7", "@")
    NULL

    # enable usage of <S7_object>@name in user code
    # e.g. if you also want users to be able to access properties
    # of objects your package
    .onAttach <- function(libname, pkgname) {
      if (getRversion() < "4.3.0")
        require(S7)
    }
    ```
