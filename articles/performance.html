<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Performance â€¢ S7</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Performance">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">S7</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/S7.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/generics-methods.html">Generics and methods</a></li>
    <li><a class="dropdown-item" href="../articles/classes-objects.html">Classes and objects</a></li>
    <li><a class="dropdown-item" href="../articles/compatibility.html">Compatibility with S3 and S4</a></li>
    <li><a class="dropdown-item" href="../articles/packages.html">Using S7 in a package</a></li>
    <li><a class="dropdown-item" href="../articles/motivation.html">Motivation for S7</a></li>
    <li><a class="dropdown-item" href="../articles/performance.html">Performance</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news">
<li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2024/11/s7-0-2-0/">S7 0.2.0</a></li>
    <li><a class="external-link dropdown-item" href="https://blog.r-project.org/2024/05/17/generalizing-support-for-functional-oop-in-r/index.html">S7 0.1.0</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/RConsortium/S7/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Performance</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/RConsortium/S7/blob/main/vignettes/performance.Rmd" class="external-link"><code>vignettes/performance.Rmd</code></a></small>
      <div class="d-none name"><code>performance.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rconsortium.github.io/S7/">S7</a></span><span class="op">)</span></span></code></pre></div>
<p>The dispatch performance should be roughly on par with S3 and S4,
though as this is implemented in a package there is some overhead due to
<code>.Call</code> vs <code>.Primitive</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Text</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_class.html">new_class</a></span><span class="op">(</span><span class="st">"Text"</span>, parent <span class="op">=</span> <span class="va">class_character</span><span class="op">)</span></span>
<span><span class="va">Number</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_class.html">new_class</a></span><span class="op">(</span><span class="st">"Number"</span>, parent <span class="op">=</span> <span class="va">class_double</span><span class="op">)</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">Text</span><span class="op">(</span><span class="st">"hi"</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">Number</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">foo_S7</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_generic.html">new_generic</a></span><span class="op">(</span><span class="st">"foo_S7"</span>, <span class="st">"x"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/method.html">method</a></span><span class="op">(</span><span class="va">foo_S7</span>, <span class="va">Text</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"-foo"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">foo_S3</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/UseMethod.html" class="external-link">UseMethod</a></span><span class="op">(</span><span class="st">"foo_S3"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">foo_S3.Text</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"-foo"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">methods</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/methods/setOldClass.html" class="external-link">setOldClass</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Number"</span>, <span class="st">"numeric"</span>, <span class="st">"S7_object"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/methods/setOldClass.html" class="external-link">setOldClass</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Text"</span>, <span class="st">"character"</span>, <span class="st">"S7_object"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/methods/setGeneric.html" class="external-link">setGeneric</a></span><span class="op">(</span><span class="st">"foo_S4"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/standardGeneric.html" class="external-link">standardGeneric</a></span><span class="op">(</span><span class="st">"foo_S4"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "foo_S4"</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span><span class="st">"foo_S4"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Text"</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"-foo"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Measure performance of single dispatch</span></span>
<span><span class="fu">bench</span><span class="fu">::</span><span class="fu"><a href="http://bench.r-lib.org/reference/mark.html" class="external-link">mark</a></span><span class="op">(</span><span class="fu">foo_S7</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="fu">foo_S3</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="fu">foo_S4</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 Ã— 6</span></span></span>
<span><span class="co">#&gt;   expression      min   median `itr/sec` mem_alloc `gc/sec`</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;bch:expr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;bch:tm&gt;</span> <span style="color: #949494; font-style: italic;">&lt;bch:tm&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;bch:byt&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> foo_S7(x)    7.28Âµs   8.37Âµs   <span style="text-decoration: underline;">113</span>349.    18.2KB     22.7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> foo_S3(x)     2.6Âµs   2.87Âµs   <span style="text-decoration: underline;">320</span>312.        0B     32.0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> foo_S4(x)    2.83Âµs   3.23Âµs   <span style="text-decoration: underline;">302</span>052.        0B      0</span></span>
<span></span>
<span><span class="va">bar_S7</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_generic.html">new_generic</a></span><span class="op">(</span><span class="st">"bar_S7"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/method.html">method</a></span><span class="op">(</span><span class="va">bar_S7</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">Text</span>, <span class="va">Number</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">...</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"-"</span>, <span class="va">y</span>, <span class="st">"-bar"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/methods/setGeneric.html" class="external-link">setGeneric</a></span><span class="op">(</span><span class="st">"bar_S4"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">...</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/standardGeneric.html" class="external-link">standardGeneric</a></span><span class="op">(</span><span class="st">"bar_S4"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "bar_S4"</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/methods/setMethod.html" class="external-link">setMethod</a></span><span class="op">(</span><span class="st">"bar_S4"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Text"</span>, <span class="st">"Number"</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">...</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"-"</span>, <span class="va">y</span>, <span class="st">"-bar"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Measure performance of double dispatch</span></span>
<span><span class="fu">bench</span><span class="fu">::</span><span class="fu"><a href="http://bench.r-lib.org/reference/mark.html" class="external-link">mark</a></span><span class="op">(</span><span class="fu">bar_S7</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span>, <span class="fu">bar_S4</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 Ã— 6</span></span></span>
<span><span class="co">#&gt;   expression        min   median `itr/sec` mem_alloc `gc/sec`</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;bch:expr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;bch:tm&gt;</span> <span style="color: #949494; font-style: italic;">&lt;bch:tm&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;bch:byt&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> bar_S7(x, y)  14.12Âµs  15.62Âµs    <span style="text-decoration: underline;">62</span>719.        0B     25.1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> bar_S4(x, y)   7.99Âµs   8.88Âµs   <span style="text-decoration: underline;">111</span>036.        0B     22.2</span></span></code></pre></div>
<p>A potential optimization is caching based on the class names, but
lookup should be fast without this.</p>
<p>The following benchmark generates a class hierarchy of different
levels and lengths of class names and compares the time to dispatch on
the first class in the hierarchy vs the time to dispatch on the last
class.</p>
<p>We find that even in very extreme cases (e.g.Â 100 deep hierarchy 100
of character class names) the overhead is reasonable, and for more
reasonable cases (e.g.Â 10 deep hierarchy of 15 character class names)
the overhead is basically negligible.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rconsortium.github.io/S7/">S7</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">gen_character</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">n</span>, <span class="va">min</span> <span class="op">=</span> <span class="fl">5</span>, <span class="va">max</span> <span class="op">=</span> <span class="fl">25</span>, <span class="va">values</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">letters</span>, <span class="va">LETTERS</span>, <span class="fl">0</span><span class="op">:</span><span class="fl">9</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">lengths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">min</span><span class="op">:</span><span class="va">max</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>, size <span class="op">=</span> <span class="va">n</span><span class="op">)</span></span>
<span>  <span class="va">values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">values</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">lengths</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="va">starts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">lengths</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="va">n</span><span class="op">]</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">ends</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">lengths</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/mapply.html" class="external-link">mapply</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">start</span>, <span class="va">end</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">values</span><span class="op">[</span><span class="va">start</span><span class="op">:</span><span class="va">end</span><span class="op">]</span>, collapse<span class="op">=</span><span class="st">""</span><span class="op">)</span>, <span class="va">starts</span>, <span class="va">ends</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">bench</span><span class="fu">::</span><span class="fu"><a href="http://bench.r-lib.org/reference/press.html" class="external-link">press</a></span><span class="op">(</span></span>
<span>  num_classes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">50</span>, <span class="fl">100</span><span class="op">)</span>,</span>
<span>  class_nchar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">15</span>, <span class="fl">100</span><span class="op">)</span>,</span>
<span>  <span class="op">{</span></span>
<span>    <span class="co"># Construct a class hierarchy with that number of classes</span></span>
<span>    <span class="va">Text</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_class.html">new_class</a></span><span class="op">(</span><span class="st">"Text"</span>, parent <span class="op">=</span> <span class="va">class_character</span><span class="op">)</span></span>
<span>    <span class="va">parent</span> <span class="op">&lt;-</span> <span class="va">Text</span></span>
<span>    <span class="va">classes</span> <span class="op">&lt;-</span> <span class="fu">gen_character</span><span class="op">(</span><span class="va">num_classes</span>, min <span class="op">=</span> <span class="va">class_nchar</span>, max <span class="op">=</span> <span class="va">class_nchar</span><span class="op">)</span></span>
<span>    <span class="va">env</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">new.env</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">x</span> <span class="kw">in</span> <span class="va">classes</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/assign.html" class="external-link">assign</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="../reference/new_class.html">new_class</a></span><span class="op">(</span><span class="va">x</span>, parent <span class="op">=</span> <span class="va">parent</span><span class="op">)</span>, <span class="va">env</span><span class="op">)</span></span>
<span>      <span class="va">parent</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">env</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span>    <span class="co"># Get the last defined class</span></span>
<span>    <span class="va">cls</span> <span class="op">&lt;-</span> <span class="va">parent</span></span>
<span></span>
<span>    <span class="co"># Construct an object of that class</span></span>
<span>    <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">cls</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"hi"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># Define a generic and a method for the last class (best case scenario)</span></span>
<span>    <span class="va">foo_S7</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_generic.html">new_generic</a></span><span class="op">(</span><span class="st">"foo_S7"</span>, <span class="st">"x"</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="../reference/method.html">method</a></span><span class="op">(</span><span class="va">foo_S7</span>, <span class="va">cls</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"-foo"</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># Define a generic and a method for the first class (worst case scenario)</span></span>
<span>    <span class="va">foo2_S7</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_generic.html">new_generic</a></span><span class="op">(</span><span class="st">"foo2_S7"</span>, <span class="st">"x"</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="../reference/method.html">method</a></span><span class="op">(</span><span class="va">foo2_S7</span>, <span class="va">S7_object</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"-foo"</span><span class="op">)</span></span>
<span></span>
<span>    <span class="fu">bench</span><span class="fu">::</span><span class="fu"><a href="http://bench.r-lib.org/reference/mark.html" class="external-link">mark</a></span><span class="op">(</span></span>
<span>      best <span class="op">=</span> <span class="fu">foo_S7</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>      worst <span class="op">=</span> <span class="fu">foo2_S7</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 20 Ã— 8</span></span></span>
<span><span class="co">#&gt;    expression num_classes class_nchar      min   median `itr/sec` mem_alloc `gc/sec`</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;bch:expr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;bch:tm&gt;</span> <span style="color: #949494; font-style: italic;">&lt;bch:tm&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;bch:byt&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> best                 3          15    7.3Âµs   8.56Âµs   <span style="text-decoration: underline;">114</span>666.        0B     34.4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> worst                3          15   7.72Âµs   8.91Âµs   <span style="text-decoration: underline;">109</span>513.        0B     32.9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> best                 5          15   7.51Âµs   8.66Âµs   <span style="text-decoration: underline;">112</span>671.        0B     33.8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> worst                5          15   7.59Âµs   8.66Âµs   <span style="text-decoration: underline;">112</span>607.        0B     33.8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> best                10          15   7.48Âµs   8.48Âµs   <span style="text-decoration: underline;">115</span>529.        0B     34.7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> worst               10          15   7.88Âµs   9.09Âµs   <span style="text-decoration: underline;">107</span>607.        0B     21.5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> best                50          15   8.04Âµs   9.21Âµs   <span style="text-decoration: underline;">106</span>323.        0B     31.9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> worst               50          15   9.64Âµs  10.93Âµs    <span style="text-decoration: underline;">89</span>208.        0B     26.8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> best               100          15   8.61Âµs   9.88Âµs    <span style="text-decoration: underline;">98</span>609.        0B     39.5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> worst              100          15  12.11Âµs  13.25Âµs    <span style="text-decoration: underline;">73</span>646.        0B     22.1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> best                 3         100    7.5Âµs   8.64Âµs   <span style="text-decoration: underline;">113</span>555.        0B     34.1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> worst                3         100   7.57Âµs   8.63Âµs   <span style="text-decoration: underline;">113</span>397.        0B     45.4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span> best                 5         100   7.62Âµs    8.7Âµs   <span style="text-decoration: underline;">112</span>648.        0B     33.8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span> worst                5         100   7.96Âµs   9.22Âµs   <span style="text-decoration: underline;">105</span>297.        0B     31.6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span> best                10         100    7.6Âµs   8.93Âµs   <span style="text-decoration: underline;">107</span>934.        0B     32.4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">16</span> worst               10         100   8.39Âµs   9.68Âµs   <span style="text-decoration: underline;">100</span>354.        0B     30.1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">17</span> best                50         100   8.04Âµs   9.48Âµs   <span style="text-decoration: underline;">102</span>079.        0B     30.6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">18</span> worst               50         100   13.2Âµs  14.51Âµs    <span style="text-decoration: underline;">67</span>148.        0B     20.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">19</span> best               100         100   8.82Âµs  10.06Âµs    <span style="text-decoration: underline;">96</span>942.        0B     29.1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">20</span> worst              100         100  19.54Âµs  20.98Âµs    <span style="text-decoration: underline;">46</span>575.        0B     14.0</span></span></code></pre></div>
<p>And the same benchmark using double-dispatch</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">bench</span><span class="fu">::</span><span class="fu"><a href="http://bench.r-lib.org/reference/press.html" class="external-link">press</a></span><span class="op">(</span></span>
<span>  num_classes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">50</span>, <span class="fl">100</span><span class="op">)</span>,</span>
<span>  class_nchar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">15</span>, <span class="fl">100</span><span class="op">)</span>,</span>
<span>  <span class="op">{</span></span>
<span>    <span class="co"># Construct a class hierarchy with that number of classes</span></span>
<span>    <span class="va">Text</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_class.html">new_class</a></span><span class="op">(</span><span class="st">"Text"</span>, parent <span class="op">=</span> <span class="va">class_character</span><span class="op">)</span></span>
<span>    <span class="va">parent</span> <span class="op">&lt;-</span> <span class="va">Text</span></span>
<span>    <span class="va">classes</span> <span class="op">&lt;-</span> <span class="fu">gen_character</span><span class="op">(</span><span class="va">num_classes</span>, min <span class="op">=</span> <span class="va">class_nchar</span>, max <span class="op">=</span> <span class="va">class_nchar</span><span class="op">)</span></span>
<span>    <span class="va">env</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">new.env</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">x</span> <span class="kw">in</span> <span class="va">classes</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/assign.html" class="external-link">assign</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="../reference/new_class.html">new_class</a></span><span class="op">(</span><span class="va">x</span>, parent <span class="op">=</span> <span class="va">parent</span><span class="op">)</span>, <span class="va">env</span><span class="op">)</span></span>
<span>      <span class="va">parent</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">env</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span>    <span class="co"># Get the last defined class</span></span>
<span>    <span class="va">cls</span> <span class="op">&lt;-</span> <span class="va">parent</span></span>
<span></span>
<span>    <span class="co"># Construct an object of that class</span></span>
<span>    <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">cls</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"hi"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">cls</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"ho"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># Define a generic and a method for the last class (best case scenario)</span></span>
<span>    <span class="va">foo_S7</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_generic.html">new_generic</a></span><span class="op">(</span><span class="st">"foo_S7"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="../reference/method.html">method</a></span><span class="op">(</span><span class="va">foo_S7</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">cls</span>, <span class="va">cls</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">...</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="st">"-foo"</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># Define a generic and a method for the first class (worst case scenario)</span></span>
<span>    <span class="va">foo2_S7</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_generic.html">new_generic</a></span><span class="op">(</span><span class="st">"foo2_S7"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="../reference/method.html">method</a></span><span class="op">(</span><span class="va">foo2_S7</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">S7_object</span>, <span class="va">S7_object</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">...</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="st">"-foo"</span><span class="op">)</span></span>
<span></span>
<span>    <span class="fu">bench</span><span class="fu">::</span><span class="fu"><a href="http://bench.r-lib.org/reference/mark.html" class="external-link">mark</a></span><span class="op">(</span></span>
<span>      best <span class="op">=</span> <span class="fu">foo_S7</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span>,</span>
<span>      worst <span class="op">=</span> <span class="fu">foo2_S7</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 20 Ã— 8</span></span></span>
<span><span class="co">#&gt;    expression num_classes class_nchar      min   median `itr/sec` mem_alloc `gc/sec`</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;bch:expr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;bch:tm&gt;</span> <span style="color: #949494; font-style: italic;">&lt;bch:tm&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;bch:byt&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> best                 3          15    9.1Âµs   10.6Âµs    <span style="text-decoration: underline;">90</span>659.        0B     36.3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> worst                3          15    9.4Âµs   10.7Âµs    <span style="text-decoration: underline;">91</span>236.        0B     36.5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> best                 5          15   9.06Âµs   10.4Âµs    <span style="text-decoration: underline;">93</span>592.        0B     28.1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> worst                5          15   9.62Âµs     11Âµs    <span style="text-decoration: underline;">88</span>059.        0B     35.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> best                10          15   9.23Âµs   10.6Âµs    <span style="text-decoration: underline;">91</span>952.        0B     36.8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> worst               10          15   9.96Âµs   10.7Âµs    <span style="text-decoration: underline;">92</span>514.        0B     27.8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> best                50          15  10.06Âµs   10.8Âµs    <span style="text-decoration: underline;">91</span>469.        0B     27.4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> worst               50          15  13.48Âµs   14.2Âµs    <span style="text-decoration: underline;">69</span>536.        0B     27.8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> best               100          15  11.37Âµs   12.2Âµs    <span style="text-decoration: underline;">80</span>642.        0B     32.3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> worst              100          15  18.29Âµs   19.6Âµs    <span style="text-decoration: underline;">49</span>812.        0B     19.9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> best                 3         100   9.38Âµs   10.5Âµs    <span style="text-decoration: underline;">92</span>297.        0B     27.7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> worst                3         100  10.09Âµs   11.2Âµs    <span style="text-decoration: underline;">86</span>116.        0B     34.5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span> best                 5         100   9.24Âµs   10.3Âµs    <span style="text-decoration: underline;">94</span>106.        0B     37.7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span> worst                5         100  10.15Âµs   11.2Âµs    <span style="text-decoration: underline;">87</span>029.        0B     26.1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span> best                10         100   9.27Âµs   10.4Âµs    <span style="text-decoration: underline;">93</span>191.        0B     37.3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">16</span> worst               10         100   11.6Âµs   12.7Âµs    <span style="text-decoration: underline;">76</span>498.        0B     30.6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">17</span> best                50         100  10.52Âµs   11.6Âµs    <span style="text-decoration: underline;">84</span>160.        0B     33.7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">18</span> worst               50         100  19.71Âµs   20.8Âµs    <span style="text-decoration: underline;">47</span>051.        0B     14.1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">19</span> best               100         100  11.58Âµs   12.8Âµs    <span style="text-decoration: underline;">75</span>653.        0B     30.3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">20</span> worst              100         100  30.89Âµs   32.5Âµs    <span style="text-decoration: underline;">30</span>228.        0B     12.1</span></span></code></pre></div>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Davis Vaughan, Jim Hester, Tomasz Kalinowski, Will Landau, Michael Lawrence, Martin Maechler, Luke Tierney, Hadley Wickham.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
