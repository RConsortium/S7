<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Compatibility with S3 and S4 • S7</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Compatibility with S3 and S4">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">S7</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/S7.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/generics-methods.html">Generics and methods</a></li>
    <li><a class="dropdown-item" href="../articles/classes-objects.html">Classes and objects</a></li>
    <li><a class="dropdown-item" href="../articles/compatibility.html">Compatibility with S3 and S4</a></li>
    <li><a class="dropdown-item" href="../articles/packages.html">Using S7 in a package</a></li>
    <li><a class="dropdown-item" href="../articles/motivation.html">Motivation for S7</a></li>
    <li><a class="dropdown-item" href="../articles/performance.html">Performance</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news">
<li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2024/11/s7-0-2-0/">S7 0.2.0</a></li>
    <li><a class="external-link dropdown-item" href="https://blog.r-project.org/2024/05/17/generalizing-support-for-functional-oop-in-r/index.html">S7 0.1.0</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/RConsortium/S7/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Compatibility with S3 and S4</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/RConsortium/S7/blob/main/vignettes/compatibility.Rmd" class="external-link"><code>vignettes/compatibility.Rmd</code></a></small>
      <div class="d-none name"><code>compatibility.Rmd</code></div>
    </div>

    
    
<p>S7 is designed to be compatible with S3 and S4. This vignette
discusses the details.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rconsortium.github.io/S7/">S7</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="s3">S3<a class="anchor" aria-label="anchor" href="#s3"></a>
</h2>
<p>S7 objects <em>are</em> S3 objects, because S7 is implemented on top
of S3. There are two main differences between an S7 object and an S3
object:</p>
<ul>
<li><p>As well as the <code>class</code> attribute possessed by S3
objects, S7 objects have an additional <code>S7_class</code> attribute
that contains the object that defines the class.</p></li>
<li><p>S7 objects have properties; S3 objects have attributes.
Properties are implemented on top of attributes, so you can access them
directly with <code>attr</code> and friends. When working inside of S7,
you should never use attributes directly, but it does mean that existing
code will continue to work.</p></li>
</ul>
<p>All up, this means most usage of S7 with S3 will just work.</p>
<ul>
<li>
<p>S7 can register methods for:</p>
<ul>
<li>S7 class and S3 generic</li>
<li>S3 class and S7 generic</li>
</ul>
</li>
<li><p>S7 classes can extend S3 classes</p></li>
<li><p>S3 classes can extend S7 classes</p></li>
</ul>
<div class="section level3">
<h3 id="methods">Methods<a class="anchor" aria-label="anchor" href="#methods"></a>
</h3>
<p><code><a href="../reference/method.html">method()</a></code> is designed to be the single tool for method
registration that you need when working with S7 classes. You can also
register a method for an S7 class and S3 generic without using S7,
because all S7 objects have S3 classes, and S3 dispatch will operate on
them normally.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Foo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_class.html">new_class</a></span><span class="op">(</span><span class="st">"Foo"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="fu">Foo</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Foo"       "S7_object"</span></span>
<span></span>
<span><span class="va">mean.Foo</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="st">"mean of foo"</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu">Foo</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "mean of foo"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="classes">Classes<a class="anchor" aria-label="anchor" href="#classes"></a>
</h3>
<p>It’s possible to extend an S7 class with S3. This is primarily useful
because in many cases it allows you to change a class hierarchy from the
inside out: you can provide a formal definition of an S3 class using S7,
and its subclasses don’t need to change.</p>
</div>
<div class="section level3">
<h3 id="list-classes">List classes<a class="anchor" aria-label="anchor" href="#list-classes"></a>
</h3>
<p>Many simple S3 classes are implemented as lists, e.g. rle.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rle</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">is.vector</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">is.list</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"'x' must be a vector of an atomic type"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">n</span> <span class="op">==</span> <span class="fl">0L</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">new_rle</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">integer</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">x</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">y</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="op">-</span><span class="fl">1L</span><span class="op">]</span> <span class="op">!=</span> <span class="va">x</span><span class="op">[</span><span class="op">-</span><span class="va">n</span><span class="op">]</span></span>
<span>    <span class="va">i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">y</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span>, <span class="va">n</span><span class="op">)</span></span>
<span>    <span class="fu">new_rle</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0L</span>, <span class="va">i</span><span class="op">)</span><span class="op">)</span>, <span class="va">x</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="va">new_rle</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">lengths</span>, <span class="va">values</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/structure.html" class="external-link">structure</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      lengths <span class="op">=</span> <span class="va">lengths</span>,</span>
<span>      values <span class="op">=</span> <span class="va">values</span></span>
<span>    <span class="op">)</span>,</span>
<span>    class <span class="op">=</span> <span class="st">"rle"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>There are two ways to convert this to S7. You could keep the
structure exactly the same, using a <code>list</code> as the underlying
data structure and using a constructor to enforce the structure:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new_rle</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_class.html">new_class</a></span><span class="op">(</span><span class="st">"rle"</span>,</span>
<span>  parent <span class="op">=</span> <span class="va">class_list</span>,</span>
<span>  constructor <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">lengths</span>, <span class="va">values</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/new_class.html">new_object</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>lengths <span class="op">=</span> <span class="va">lengths</span>, values <span class="op">=</span> <span class="va">values</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rle.html" class="external-link">rle</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt; Run Length Encoding</span></span>
<span><span class="co">#&gt;   lengths: int [1:10] 1 1 1 1 1 1 1 1 1 1</span></span>
<span><span class="co">#&gt;   values : int [1:10] 1 2 3 4 5 6 7 8 9 10</span></span></code></pre></div>
<p>Alternatively you could convert it to the most natural representation
using S7:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new_rle</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_class.html">new_class</a></span><span class="op">(</span><span class="st">"rle"</span>, properties <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  lengths <span class="op">=</span> <span class="va">class_integer</span>,</span>
<span>  values <span class="op">=</span> <span class="va">class_atomic</span></span>
<span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>To allow existing methods to work you’ll need to override
<code>$</code> to access properties instead of list elements:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/method.html">method</a></span><span class="op">(</span><span class="va">`$`</span>, <span class="va">new_rle</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">prop</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rle.html" class="external-link">rle</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt; Run Length Encoding</span></span>
<span><span class="co">#&gt;   lengths: int [1:10] 1 1 1 1 1 1 1 1 1 1</span></span>
<span><span class="co">#&gt;   values : int [1:10] 1 2 3 4 5 6 7 8 9 10</span></span></code></pre></div>
<p>The chief disadvantage of this approach is any subclasses will need
to be converted to S7 as well.</p>
</div>
</div>
<div class="section level2">
<h2 id="s4">S4<a class="anchor" aria-label="anchor" href="#s4"></a>
</h2>
<p>S7 properties are equivalent to S4 slots. The chief difference is
that they can be dynamic.</p>
<ul>
<li>S7 classes can not extend S4 classes</li>
<li>S4 classes can extend S3 classes</li>
<li>S7 can register methods for:
<ul>
<li>S7 class and S4 generic</li>
<li>S4 class and S7 generic</li>
</ul>
</li>
</ul>
<div class="section level3">
<h3 id="unions">Unions<a class="anchor" aria-label="anchor" href="#unions"></a>
</h3>
<p>S4 unions are automatically converted to S7 unions. There’s an
important difference in the way that class unions are handled in S4 and
S7. In S4, they’re handled at method dispatch time, so when you create
<code>setUnion("u1", c("class1", "class2"))</code>, <code>class1</code>
and <code>class2</code> now extend <code>u1</code>. In S7, unions are
handled at method registration time so that registering a method for a
union is just short-hand for registering a method for each of the
classes.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Class1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_class.html">new_class</a></span><span class="op">(</span><span class="st">"Class1"</span><span class="op">)</span></span>
<span><span class="va">Class2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_class.html">new_class</a></span><span class="op">(</span><span class="st">"Class2"</span><span class="op">)</span></span>
<span><span class="va">Union1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_union.html">new_union</a></span><span class="op">(</span><span class="va">Class1</span>, <span class="va">Class2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">foo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_generic.html">new_generic</a></span><span class="op">(</span><span class="st">"foo"</span>, <span class="st">"x"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/method.html">method</a></span><span class="op">(</span><span class="va">foo</span>, <span class="va">Union1</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="st">""</span></span>
<span><span class="va">foo</span></span>
<span><span class="co">#&gt; &lt;S7_generic&gt; foo(x, ...) with 2 methods:</span></span>
<span><span class="co">#&gt; 1: method(foo, Class2)</span></span>
<span><span class="co">#&gt; 2: method(foo, Class1)</span></span></code></pre></div>
<p>S7 unions allow you to restrict the type of a property in the same
way that S4 unions allow you to restrict the type of a slot.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Davis Vaughan, Jim Hester, Tomasz Kalinowski, Will Landau, Michael Lawrence, Martin Maechler, Luke Tierney, Hadley Wickham.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
