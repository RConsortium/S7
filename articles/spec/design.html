<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Design specification • S7</title>
<script src="../../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../../deps/headroom-0.11.0/headroom.min.js"></script><script src="../../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../../deps/search-1.0.0/fuse.min.js"></script><script src="../../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../../pkgdown.js"></script><meta property="og:title" content="Design specification">
<meta name="description" content="Design specification used to guide the implementation.">
<meta property="og:description" content="Design specification used to guide the implementation.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../../index.html">S7</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../../articles/S7.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../../articles/generics-methods.html">Generics and methods</a></li>
    <li><a class="dropdown-item" href="../../articles/classes-objects.html">Classes and objects</a></li>
    <li><a class="dropdown-item" href="../../articles/compatibility.html">Compatibility with S3 and S4</a></li>
    <li><a class="dropdown-item" href="../../articles/packages.html">Using S7 in a package</a></li>
    <li><a class="dropdown-item" href="../../articles/motivation.html">Motivation for S7</a></li>
    <li><a class="dropdown-item" href="../../articles/performance.html">Performance</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../../articles/index.html">More articles...</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news">
<li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2024/11/s7-0-2-0/">S7 0.2.0</a></li>
    <li><a class="external-link dropdown-item" href="https://blog.r-project.org/2024/05/17/generalizing-support-for-functional-oop-in-r/index.html">S7 0.1.0</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../../news/index.html">Changelog</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/RConsortium/S7/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Design specification</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/RConsortium/S7/blob/main/vignettes/spec/design.Rmd" class="external-link"><code>vignettes/spec/design.Rmd</code></a></small>
      <div class="d-none name"><code>design.Rmd</code></div>
    </div>

    
    
<p>This document presents a broad overview of the S7 object-oriented
programming toolkit. (Please note that S7 is a working name and may
change in the future.)</p>
<div class="section level2">
<h2 id="objects">Objects<a class="anchor" aria-label="anchor" href="#objects"></a>
</h2>
<p>We define an S7 object as any R object with:</p>
<ul>
<li>A class object attribute, a reference to the <strong>class
object</strong>, and retrieved with <code>classObject()</code>.</li>
<li>For S3 compatibility, a class attribute, a character vector of class
names.</li>
<li>Additional attributes storing <strong>properties</strong> defined by
the class, accessible with <code>@</code>/<code><a href="../../reference/prop.html">prop()</a></code>.</li>
</ul>
</div>
<div class="section level2">
<h2 id="classes">Classes<a class="anchor" aria-label="anchor" href="#classes"></a>
</h2>
<p>S7 classes are first class objects (Req2) with the following
components:</p>
<ul>
<li><p><strong>Name</strong>, a human-meaningful descriptor for the
class. This is used for the default print method and in error messages;
it does not identify the class.</p></li>
<li><p><strong>Parent</strong>, the class object of the parent class.
This implies single inheritance (Req6).</p></li>
<li><p>A <strong>constructor</strong>, an user-facing function used to
create new objects of this class. It always ends with a call to
<code>newObject()</code> to initialize the class. This the function
(wrapped appropriately) that represents the class.</p></li>
<li><p><strong>A validator</strong>, a function that takes the object
and returns <code>NULL</code> if the object is valid, otherwise a
character vector of error messages (like the methods package).</p></li>
<li><p><strong>Properties</strong>, a list of property objects (see
below) that define the data that objects can possess.</p></li>
</ul>
<p>Classes are constructed by supplying these components to a call to
<code>newClass()</code>. <code>newClass()</code> returns a class object
that can be called to construct an object of that class.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">newClass</span><span class="op">(</span></span>
<span>  <span class="va">name</span>,</span>
<span>  parent <span class="op">=</span> <span class="va">Object</span>,</span>
<span>  constructor <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="fu">newObject</span><span class="op">(</span><span class="va">...</span><span class="op">)</span>,</span>
<span>  validator <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="cn">NULL</span>,</span>
<span>  properties <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>For example:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Range</span> <span class="op">&lt;-</span> <span class="fu">newClass</span><span class="op">(</span><span class="st">"Range"</span>,</span>
<span>  <span class="va">Vector</span>,</span>
<span>  constructor <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">start</span>, <span class="va">end</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">is.numeric</a></span><span class="op">(</span><span class="va">start</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">is.numeric</a></span><span class="op">(</span><span class="va">end</span><span class="op">)</span>, <span class="va">end</span> <span class="op">&gt;=</span> <span class="va">start</span><span class="op">)</span></span>
<span>    <span class="fu">newObject</span><span class="op">(</span>start <span class="op">=</span> <span class="va">start</span>, end <span class="op">=</span> <span class="va">end</span><span class="op">)</span></span>
<span>  <span class="op">}</span>,</span>
<span>  validator <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">x</span><span class="op">@</span><span class="va">end</span> <span class="op">&lt;</span> <span class="va">x</span><span class="op">@</span><span class="va">start</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="st">"end must be greater than or equal to start"</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span>,</span>
<span>  properties <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>start <span class="op">=</span> <span class="st">"numeric"</span>, end <span class="op">=</span> <span class="st">"numeric"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">Range</span><span class="op">(</span>start <span class="op">=</span> <span class="fl">1</span>, end <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="initialization">Initialization<a class="anchor" aria-label="anchor" href="#initialization"></a>
</h3>
<p>The constructor uses <code>newObject()</code> to
<strong>initialize</strong> a new object. This:</p>
<ol style="list-style-type: decimal">
<li>Inspects the enclosing scope to find the “current” class.</li>
<li>Creates the prototype, by either by calling the parent constructor
or by creating a base type and adding <code>class</code> and
<code>classObject</code> attributes to it.</li>
<li>Validates properties then adds to prototype.</li>
<li>Validates the complete object.</li>
</ol>
<p>Steps 2 and 3 are similar to calling <code><a href="https://rdrr.io/r/base/structure.html" class="external-link">structure()</a></code>, except
that property values are initialized and validated through the property
system.</p>
</div>
<div class="section level3">
<h3 id="shortcuts">Shortcuts<a class="anchor" aria-label="anchor" href="#shortcuts"></a>
</h3>
<p>By convention, any argument that takes a class object can instead
take the name of a class object as a string. The name will be used to
find a class object in the calling frame.</p>
<p>Similarly, instead of providing a list of property objects, you can
instead provide a named character vector. For example,
<code>c(name = "character", age = "integer")</code> is shorthand for
<code>list(newProperty("name", "character"), newProperty("age", "integer"))</code>.</p>
</div>
<div class="section level3">
<h3 id="validation">Validation<a class="anchor" aria-label="anchor" href="#validation"></a>
</h3>
<p>Objects will be validated on initialization and every time a property
is modified. To temporarily opt-out of validation (e.g. in order to
transition through a temporarily invalid state), S7 provides
<code>eventuallyValid()</code>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">eventuallyValid</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">fun</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">object</span><span class="op">$</span><span class="va">internal_validation_flag</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span></span>
<span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">fun</span><span class="op">(</span><span class="va">object</span><span class="op">)</span></span>
<span>  <span class="va">out</span><span class="op">$</span><span class="va">internal_validation_flag</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span>
<span>  <span class="fu"><a href="../../reference/validate.html">validate</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>For example, if you wanted to move a Range object to the right, you
could write:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">move_right</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">eventuallyValid</span><span class="op">(</span><span class="va">x</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">x</span><span class="op">@</span><span class="va">start</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">@</span><span class="va">start</span> <span class="op">+</span> <span class="va">y</span></span>
<span>    <span class="va">x</span><span class="op">@</span><span class="va">end</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">@</span><span class="va">end</span> <span class="op">+</span> <span class="va">y</span></span>
<span>    <span class="va">x</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>This ensures that the validation will not trigger if
<code>x@start + y</code> is greater than <code>x@end</code>.</p>
<p>S7 also provides <code>implicitlyValid()</code> for expert use. This
is similar to <code>eventuallyValid()</code> but does not check for
validity at the end. This can be used in performance critical code where
you can ascertain that a sequence of operations can never make a valid
object invalid.</p>
<p>(This can be quite hard: for example, in the
<code>move_right()</code> example above, you might think that that if
<code>x@start &lt; x@end</code> is true at the beginning, then
<code>x@start + y &lt; x@end + y</code> will still be true at the end,
and you don’t need to re-validate the object. But that’s not necessarily
true: if <code>x@start == 1</code>, <code>x@end == 2</code>, and
<code>abs(y) &gt; 2e16</code> then
<code>x@start + y == x@end + y</code>!)</p>
</div>
<div class="section level3">
<h3 id="unions">Unions<a class="anchor" aria-label="anchor" href="#unions"></a>
</h3>
<p>A class union represents a list of possible classes. It is used in
properties to allow a property to be one of a set of classes, and in
method dispatch as a convenience for defining a method for multiple
classes.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ClassUnion</span> <span class="op">&lt;-</span> <span class="fu">defineClass</span><span class="op">(</span><span class="st">"ClassUnion"</span>,</span>
<span>  properties <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>classes <span class="op">=</span> <span class="st">"list"</span><span class="op">)</span>,</span>
<span>  validator <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Checks that all elements of classes are Class object</span></span>
<span>  <span class="op">}</span>,</span>
<span>  constructor <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">classes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span>
<span>    <span class="co"># look up Class object from any class vectors</span></span>
<span>    <span class="fu">newObject</span><span class="op">(</span>classes <span class="op">=</span> <span class="va">classes</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ClassUnion</span><span class="op">(</span><span class="st">"character"</span>, <span class="st">"NULL"</span><span class="op">)</span></span>
<span><span class="fu">ClassUnion</span><span class="op">(</span><span class="va">Range</span>, <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="properties">Properties<a class="anchor" aria-label="anchor" href="#properties"></a>
</h2>
<p>Properties store the data needed by an object. Properties of an
object can be accessed using <code>@</code>/<code>@&lt;-</code> or
<code><a href="../../reference/prop.html">prop()</a></code>/<code>prop&lt;-</code>. Setting the properties of an
object always triggers validation.</p>
<p>Properties are less encapsulated than their equivalents in most
languages because R users expect transparency and want to get to the
actual data inside an object and directly manipulate it to get their
work done. Properties this support typical usage while still providing
some ability to encapsulate data and hide implementation details.</p>
<p>Every property definition has a:</p>
<ul>
<li>A <strong>name</strong>, used to label output for humans.</li>
<li>An optional <strong>class</strong> (or class union).</li>
<li>An optional <strong>accessor</strong> function that overrides
getting and setting, much like an active binding (by default, the value
is stored as attribute, like S3/S4).</li>
</ul>
<p>Property objects are created by <code>newProperty()</code>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">newProperty</span><span class="op">(</span></span>
<span>  <span class="va">name</span>,</span>
<span>  class <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  accessor <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Compared to S3 attributes, properties are considerably stricter: a
class defines the names and types of its properties. Compared to S4
slots, properties enable an object to change its internals without
breaking existing usage because it can provides a custom accessor that
redirects to the new representation. There will be built-in support for
emitting deprecation messages.</p>
<p>While it would be tempting to support public vs. private scoping on
properties, it is not obvious how to do so, because no code is more
privileged than any another. Nor is it clear whether the package should
define the boundary, when packages sometimes define methods on classes
defined in other packages and want to take advantage of their internal
representations. We believe that the encapsulation afforded by
properties is a good compromise.</p>
</div>
<div class="section level2">
<h2 id="generics">Generics<a class="anchor" aria-label="anchor" href="#generics"></a>
</h2>
<p>A generic separates function interface from implementation: the
generic defines the interface, and methods provide the implementation.
For introspection purposes, it knows its name and the names of the
arguments in its signature (the arguments considered during
dispatch).</p>
<p>Calling <code>newGeneric()</code> defines a new generic. It has the
signature:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">newGeneric</span><span class="op">(</span><span class="va">name</span>, <span class="va">FUN</span>, <span class="va">signature</span><span class="op">)</span></span></code></pre></div>
<p>The <code>signature</code> would default to the first argument,
i.e. <code>formals(FUN)[1]</code>. The body of <code>FUN</code> would
resemble S3 and S4 generics. It might just call
<code><a href="https://rdrr.io/r/base/UseMethod.html" class="external-link">UseMethod()</a></code>.</p>
<p>By convention, any argument that takes a generic function, can
instead take the name of a generic function supplied as a string. The
name will be used to find the class object in the calling frame.</p>
</div>
<div class="section level2">
<h2 id="methods">Methods<a class="anchor" aria-label="anchor" href="#methods"></a>
</h2>
<div class="section level3">
<h3 id="creation">Creation<a class="anchor" aria-label="anchor" href="#creation"></a>
</h3>
<p>Methods are defined by calling
<code>method&lt;-(generic, signature, method)</code>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/method.html">method</a></span><span class="op">(</span><span class="va">generic</span>, <span class="va">signature</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span><span class="op">}</span></span></code></pre></div>
<ul>
<li><p><code>generic</code> is a generic function.</p></li>
<li><p><code>signature</code> is a single class object, a class union,
list of class objects/unions, or a character vector.</p></li>
<li><p><code>method</code> is a compatible function, i.e. all arguments
before <code>...</code> have the same names in the same order; if the
generic doesn’t have <code>...</code> all arguments must be
same.</p></li>
</ul>
<p>Documentation will discuss the risks of defining a method when you
don’t own either the generic or the class.</p>
<p><code>method&lt;-</code> is designed to work at run-time (not just
package build-time) so that methods can be defined when packages that
define classes or generics are loaded after the package that defines the
methods. This typically occurs when providing methods for generics or
classes in suggested packages.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">whenLoaded</span><span class="op">(</span><span class="st">"pkg"</span>, <span class="op">{</span></span>
<span>  <span class="fu"><a href="../../reference/method.html">method</a></span><span class="op">(</span><span class="va">mean</span>, <span class="fu">pkg</span><span class="fu">::</span><span class="va">A</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fl">10</span></span>
<span>  <span class="fu"><a href="../../reference/method.html">method</a></span><span class="op">(</span><span class="va">sum</span>, <span class="fu">pkg</span><span class="fu">::</span><span class="va">A</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="fl">5</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="dispatch">Dispatch<a class="anchor" aria-label="anchor" href="#dispatch"></a>
</h3>
<p>Dispatch is nested, meaning that if there are multiple arguments in
the generic signature, it will dispatch on the first argument, then the
second. Nested dispatch is likely easier to predict and understand
compared to treating all arguments with equal precedence. Nested
dispatch is also easier to implement efficiently, because classes would
effectively inherit methods, and we could implement that inheritance
using environments.</p>
<p>For example, a <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> generic dispatching on
<code>x</code> could be implemented like this:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../../reference/method.html">method</a></span><span class="op">(</span><span class="va">plot</span>, <span class="fu">classObject</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>While a <code>publish()</code> that publishes an object
<code>x</code> to a destination <code>y</code>, dispatching on both
arguments, could be implemented as:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">publish</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">sig</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu">classObject</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="fu">classObject</span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../../reference/method.html">method</a></span><span class="op">(</span><span class="va">publish</span>, <span class="va">sig</span><span class="op">)</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Because method dispatch is nested, this is presumably equivalent to
something like:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">publish</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">publish_x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/method.html">method</a></span><span class="op">(</span><span class="va">publish</span>, <span class="fu">classObject</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">publish_xy</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/method.html">method</a></span><span class="op">(</span><span class="va">publish_x</span>, <span class="fu">classObject</span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu">publish_xy</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Alternatively, the generics could just call <code><a href="https://rdrr.io/r/base/UseMethod.html" class="external-link">UseMethod()</a></code>,
which would gain support for nested dispatch.</p>
</div>
</div>
<div class="section level2">
<h2 id="compatibility">Compatibility<a class="anchor" aria-label="anchor" href="#compatibility"></a>
</h2>
<div class="section level3">
<h3 id="s3">S3<a class="anchor" aria-label="anchor" href="#s3"></a>
</h3>
<p>Since the class attribute has the same semantics as S3, S3 dispatch
should be fully compatible. The new generics should also be able to
handle legacy S3 objects.</p>
</div>
<div class="section level3">
<h3 id="s4">S4<a class="anchor" aria-label="anchor" href="#s4"></a>
</h3>
<p>In principle, we could modify the methods package so that S4 generics
can operate on the new class definitions. Since the new generics will
fallback to S3 dispatch, they should support S4 objects just as S3
generics support them now.</p>
</div>
</div>
<div class="section level2">
<h2 id="documentation">Documentation<a class="anchor" aria-label="anchor" href="#documentation"></a>
</h2>
<p>The primary challenge is that the availability of methods and classes
depends on which packages are installed, so we will need to generate
index pages that list the methods for a generic or the methods with a
particular class in their signature. The documentation blurbs could be
lazily scraped at runtime to build an index, similar to how the help
search index is created now. We would then generate help pages from the
index.</p>
<p>The index of installed methods could provide additional benefits,
including introspection. A generic could prompt the user to load a
package if it fails to find an applicable method, while there is an
installed, unloaded method available. This case would arise when a
method is defined outside of the packages that define the class and
generic.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Davis Vaughan, Jim Hester, Tomasz Kalinowski, Will Landau, Michael Lawrence, Martin Maechler, Luke Tierney, Hadley Wickham.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
