<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Requirements • S7</title>
<script src="../../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../../deps/headroom-0.11.0/headroom.min.js"></script><script src="../../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../../deps/search-1.0.0/fuse.min.js"></script><script src="../../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../../pkgdown.js"></script><meta property="og:title" content="Requirements">
<meta name="description" content="Initial technical requirements brainstorming.">
<meta property="og:description" content="Initial technical requirements brainstorming.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../../index.html">S7</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../../articles/S7.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../../articles/generics-methods.html">Generics and methods</a></li>
    <li><a class="dropdown-item" href="../../articles/classes-objects.html">Classes and objects</a></li>
    <li><a class="dropdown-item" href="../../articles/compatibility.html">Compatibility with S3 and S4</a></li>
    <li><a class="dropdown-item" href="../../articles/packages.html">Using S7 in a package</a></li>
    <li><a class="dropdown-item" href="../../articles/motivation.html">Motivation for S7</a></li>
    <li><a class="dropdown-item" href="../../articles/performance.html">Performance</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../../articles/index.html">More articles...</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/rconsortium/S7/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Requirements</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/rconsortium/S7/blob/main/vignettes/spec/requirements.Rmd" class="external-link"><code>vignettes/spec/requirements.Rmd</code></a></small>
      <div class="d-none name"><code>requirements.Rmd</code></div>
    </div>

    
    
<p>This page is for brainstorming on the technical requirements for
solving our <a href="https://github.com/RConsortium/S7/wiki/Problem-Statement" class="external-link">problem</a>.
Once we align on the requirements, we can start the design process.</p>
<div class="section level2">
<h2 id="list-of-requirements">List of requirements<a class="anchor" aria-label="anchor" href="#list-of-requirements"></a>
</h2>
<ol style="list-style-type: decimal">
<li>The system should be as compatible as possible with existing
systems, particularly S3</li>
<li>Classes should be first class objects, extrinsic from instances</li>
<li>The system should support formal construction, casting, and coercion
to create new instances of classes.</li>
<li>It should be convenient to systematically validate an instance</li>
<li>Double dispatch, and possibly general multiple dispatch, should be
supported</li>
<li>Inheritance should be as simple as possible, ideally single (other
features might compensate for the lack of multiple inheritance)</li>
<li>Syntax should be intuitive and idiomatic, and should not rely on
side effects nor loose conventions</li>
<li>Namespace management should not be any more complicated than S3
currently</li>
<li>Performance should be competitive with existing solutions</li>
<li>The design should be simple to implement</li>
<li>It should be possible for a package to define a method where the
generic and classes are defined outside of the package</li>
<li>We should aim to facilitate API evolution, particularly as it
relates to inter-package dependencies</li>
<li>Methods must include all formal arguments from their generic (not
like Julia)</li>
<li>Generics should support <code>...</code> in their formal argument
lists and methods can append arguments to those lists</li>
<li>Fields should have “public” visibility, and should support
encapsulation (implicit getters and setters)</li>
<li>The system should support reflection</li>
<li>The system should support lazy and dynamic registration of classes
and methods.</li>
</ol>
</div>
<div class="section level2">
<h2 id="compatibility">Compatibility<a class="anchor" aria-label="anchor" href="#compatibility"></a>
</h2>
<p>Ideally the new system will be an extension of S3, because S3 is
already at the bottom of the stack and many of the other systems have
some compatibility with S3.</p>
</div>
<div class="section level2">
<h2 id="classes-as-first-class-objects">Classes as first class objects<a class="anchor" aria-label="anchor" href="#classes-as-first-class-objects"></a>
</h2>
<p>It is important for classes to be defined extrinsically from
instances, because it makes the data contract more obvious to both
developers (reading the code) and users (interacting with objects). S4
represents classes as proper objects; however, typically developers will
only refer to the classes by name (string literal) when interacting with
the S4 API. Interacting directly with objects instead would likely
simplify the API (syntax) and its implementation.</p>
</div>
<div class="section level2">
<h2 id="generics-as-extended-function-objects">Generics as extended function objects<a class="anchor" aria-label="anchor" href="#generics-as-extended-function-objects"></a>
</h2>
<p>Generic functions should be represented by a special class of
function object that tracks its own method table. This puts generic
functions at the same level as classes, which is the essence of
functional OOP, and will likely enable more natural syntax in method
registration.</p>
</div>
<div class="section level2">
<h2 id="formal-instantiation-and-type-conversion">Formal instantiation and type conversion<a class="anchor" aria-label="anchor" href="#formal-instantiation-and-type-conversion"></a>
</h2>
<p>Class instantiation should happen through a formal constructor. Once
created, an object should keep its original class unless subjected to
formal casting or formal coercion. The class of an object should be
robust and predictable, and direct class assignment
(e.g. <code>class&lt;-()</code>) should generally be avoided.</p>
</div>
<div class="section level2">
<h2 id="systematic-validation">Systematic validation<a class="anchor" aria-label="anchor" href="#systematic-validation"></a>
</h2>
<p>Class contracts are often more complicated than a simple list of
typed fields. Having a formally supported convention around validating
objects is important so that code can make the necessary assumptions
about data structures and their content. Otherwise, developers trying to
be defensive will resort to ad hoc checks scattered throughout the
code.</p>
</div>
<div class="section level2">
<h2 id="multiple-dispatch">Multiple dispatch<a class="anchor" aria-label="anchor" href="#multiple-dispatch"></a>
</h2>
<p>The system will at least need to support double dispatch, so that
code can be polymorphic on the interaction of two arguments. There are
many obvious examples: arithmetic, serialization (object, target),
coercion, etc. It is less likely that we will require dispatch beyond
two arguments, and any advantages are probably outweighed by the
increase in complexity. In many cases of triple dispatch or higher in
the wild, developers are abusing dispatch to implement type checks,
instead of polymorphism. Almost always, we can deconstruct multiple
dispatch into a series of double dispatch calls. General multiple
dispatch makes software harder to understand and is more difficult to
implement.</p>
</div>
<div class="section level2">
<h2 id="inheritance">Inheritance<a class="anchor" aria-label="anchor" href="#inheritance"></a>
</h2>
<p>Inheritance lets us define a data taxonomy, and it is often natural
to organize a set of data structures into multiple, orthogonal
taxonomies. Multiple inheritance enables that; however, it also adds a
lot of complexity, both to the software relying on it and the underlying
system. It is often possible and beneficial (in the long term) to rely
on techniques like composition and delegation instead. We should
consider how single inheritance languages like Java have been so
successful, although they are not directly comparable to our functional
system.</p>
</div>
<div class="section level2">
<h2 id="syntax">Syntax<a class="anchor" aria-label="anchor" href="#syntax"></a>
</h2>
<p>The entire API should be free of side effects and odd conventions,
like making the <code>.</code> character significant in method names.
Whereas S3 supports implicit method registration based on the name of
the method, the new system should require methods to be registered
explicitly. Direct manipulation of class and generic objects should
enable this.</p>
</div>
<div class="section level2">
<h2 id="namespaces">Namespaces<a class="anchor" aria-label="anchor" href="#namespaces"></a>
</h2>
<p>The system should support exporting generics and classes. If classes
are objects, they can be treated like any other object when exporting
and importing symbols. If generics are objects, then it should be simple
to export all methods on a generic. It is not clear whether selective
method export is important. One use case would be to hide a method with
an internal class in its signature to avoid unnecessary documentation.
Perhaps <code>R CMD check</code> could ignore methods for unexported
classes. There should be no need for explicit method registration.</p>
</div>
<div class="section level2">
<h2 id="third-party-methods">Third party methods<a class="anchor" aria-label="anchor" href="#third-party-methods"></a>
</h2>
<p>To fully realize the potential of interoperability afforded by
functional OOP, with its treating of generics and classes as orthogonal,
we should allow packages to extend an externally defined API so that it
supports externally defined classes. In most cases, a method should only
be defined by either the owner of the generic or the owner of the class,
but “ownership” is a somewhat nebulous concept. We acknowledge the
potential for conflicts arising from multiple packages defining methods
on the same generic and with overlapping signatures, as well as the
danger of injecting new behaviors that violate the assumptions of
existing method definitions.</p>
</div>
<div class="section level2">
<h2 id="formal-arguments">Formal arguments<a class="anchor" aria-label="anchor" href="#formal-arguments"></a>
</h2>
<p>The formal arguments of a generic must be present in every method for
that generic. This is in contrast to Julia, where methods can have
completely different sets of arguments. We favor a fixed set of formal
arguments for the sake of consistency and to enable calling code to
depend on a minimal set of arguments that are always present. If the
generic formal argument list includes <code>...</code>, then methods can
add their own arguments. The extra arguments are useful for controlling
specialized behaviors, as long as the calling code can assume that
calling the generic will always dispatch to a method that handles them
in accordance with the documentation. In accordance with the Liskov
Substitution Principle, we could explore enforcing that a method only
adds arguments to those of a method dispatching on a parent class. This
is easiest to conceptualize and would be most useful in the single
dispatch case, but we should also be able to develop a set of rules for
nested multiple dispatch.</p>
</div>
<div class="section level2">
<h2 id="field-visibility">Field visibility<a class="anchor" aria-label="anchor" href="#field-visibility"></a>
</h2>
<p>Functional OOP is incompatible with the notion of private fields,
because code does not run in the context of a class, and thus there is
no way to accept or deny access to a field. R users also expect and
appreciate object transparency. We will consider enabling encapsulation
of field access and modification similar to how reference classes allow
for defining fields as active bindings.</p>
</div>
<div class="section level2">
<h2 id="reflection-and-dynamism">Reflection and dynamism<a class="anchor" aria-label="anchor" href="#reflection-and-dynamism"></a>
</h2>
<p>Given a class and a generic, you should be able to find the
appropriate method without calling it. This is important for building
tooling around the system.</p>
</div>
<div class="section level2">
<h2 id="lazy-and-dynamic-registration">Lazy and dynamic registration<a class="anchor" aria-label="anchor" href="#lazy-and-dynamic-registration"></a>
</h2>
<p>On the flip side, you should also be able to register a method
lazily/dynamically at run-time. This is important for:</p>
<ul>
<li><p>Generics and classes in suggested packages, so that method
registration can occur when the dependency is loaded.</p></li>
<li><p>Testing, since you may want to define a method only within a
test. This is particularly useful when used to eliminate the need for
mocking.</p></li>
<li><p>Interface evolution, so you can provide a method for a generic or
class that does not yet exist, anticipating a future release of a
dependency.</p></li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Davis Vaughan, Jim Hester, Tomasz Kalinowski, Will Landau, Michael Lawrence, Martin Maechler, Luke Tierney, Hadley Wickham.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
