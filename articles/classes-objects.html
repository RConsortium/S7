<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="S7">
<title>Classes and objects • S7</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Classes and objects">
<meta property="og:description" content="S7">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">S7</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/S7.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/generics-methods.html">Generics and methods</a>
    <a class="dropdown-item" href="../articles/classes-objects.html">Classes and objects</a>
    <a class="dropdown-item" href="../articles/compatibility.html">Compatibility</a>
    <a class="dropdown-item" href="../articles/packages.html">Using S7 in a package</a>
    <a class="dropdown-item" href="../articles/motivation.html">Motivation for S7</a>
    <a class="dropdown-item" href="../articles/performance.html">Performance</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../articles/index.html">More articles...</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/rconsortium/S7/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Classes and objects</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/rconsortium/S7/blob/HEAD/vignettes/classes-objects.Rmd" class="external-link"><code>vignettes/classes-objects.Rmd</code></a></small>
      <div class="d-none name"><code>classes-objects.Rmd</code></div>
    </div>

    
    
<p>This vignette dives into the details of S7 classes and objects,
building on the basics discussed in <code><a href="../articles/S7.html">vignette("S7")</a></code>. It will
cover validators, the finer details of properties, and finally how to
write your own constructors.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rconsortium/S7/" class="external-link">S7</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="validation">Validation<a class="anchor" aria-label="anchor" href="#validation"></a>
</h2>
<p>S7 classes can have an optional <strong>validator</strong> that
checks that the values of the properties are OK. A validator is a
function that takes the object (called <code>self</code>) and returns
<code>NULL</code> if its valid or returns a character vector listing the
problems.</p>
<div class="section level3">
<h3 id="basics">Basics<a class="anchor" aria-label="anchor" href="#basics"></a>
</h3>
<p>In the following example we create a range class that enforces that
<code>@start</code> and <code>@end</code> are single numbers, and that
<code>@start</code> is less than <code>@end</code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">range</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_class.html">new_class</a></span><span class="op">(</span><span class="st">"range"</span>,</span>
<span>  properties <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    start <span class="op">=</span> <span class="va">class_double</span>,</span>
<span>    end <span class="op">=</span> <span class="va">class_double</span></span>
<span>  <span class="op">)</span>,</span>
<span>  validator <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">self</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">self</span><span class="op">@</span><span class="va">start</span><span class="op">)</span> <span class="op">!=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="st">"@start must be length 1"</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">self</span><span class="op">@</span><span class="va">end</span><span class="op">)</span> <span class="op">!=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="st">"@end must be length 1"</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">self</span><span class="op">@</span><span class="va">end</span> <span class="op">&lt;</span> <span class="va">self</span><span class="op">@</span><span class="va">start</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span></span>
<span>        <span class="st">"@end (%i) must be greater than or equal to @start (%i)"</span>,</span>
<span>        <span class="va">self</span><span class="op">@</span><span class="va">end</span>,</span>
<span>        <span class="va">self</span><span class="op">@</span><span class="va">start</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>You can typically write a validator as a series of
<code>if</code>-<code>else</code> statements, but note that the order of
the statements is important. For example, in the code above, we can’t
check that <code>self@end &lt; self@start</code> before we’ve checked
that <code>@start</code> and <code>@end</code> are length 1.</p>
</div>
<div class="section level3">
<h3 id="when-is-validation-performed">When is validation performed?<a class="anchor" aria-label="anchor" href="#when-is-validation-performed"></a>
</h3>
<p>Objects are validated automatically when constructed and when any
property is modified:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error: &lt;range&gt; object properties are invalid:</span></span>
<span><span class="co">#&gt; - @end must be &lt;double&gt;, not &lt;integer&gt;</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error: &lt;range&gt; object is invalid:</span></span>
<span><span class="co">#&gt; - @end (1) must be greater than or equal to @start (10)</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">x</span><span class="op">@</span><span class="va">start</span> <span class="op">&lt;-</span> <span class="fl">20</span></span>
<span><span class="co">#&gt; Error: &lt;range&gt; object is invalid:</span></span>
<span><span class="co">#&gt; - @end (10) must be greater than or equal to @start (20)</span></span></code></pre></div>
<p>You can also manually <code><a href="../reference/validate.html">validate()</a></code> an object if you use a
low-level R function to bypass the usual checks and balances of
<code>@</code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"start"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span><span class="fu"><a href="../reference/validate.html">validate</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error: &lt;range&gt; object is invalid:</span></span>
<span><span class="co">#&gt; - @end (2) must be greater than or equal to @start (3)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="avoiding-validation">Avoiding validation<a class="anchor" aria-label="anchor" href="#avoiding-validation"></a>
</h3>
<p>Imagine you wanted to write a function that would shift a property to
the left or the right:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">shift</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">shift</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">x</span><span class="op">@</span><span class="va">start</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">@</span><span class="va">start</span> <span class="op">+</span> <span class="va">shift</span></span>
<span>  <span class="va">x</span><span class="op">@</span><span class="va">end</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">@</span><span class="va">end</span> <span class="op">+</span> <span class="va">shift</span></span>
<span>  <span class="va">x</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">shift</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;range&gt;</span></span>
<span><span class="co">#&gt;  @ start: num 2</span></span>
<span><span class="co">#&gt;  @ end  : num 11</span></span></code></pre></div>
<p>There’s a problem if <code>shift</code> is larger than
<code>@end</code> - <code>@start</code>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">shift</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span><span class="op">)</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error: &lt;range&gt; object is invalid:</span></span>
<span><span class="co">#&gt; - @end (10) must be greater than or equal to @start (11)</span></span></code></pre></div>
<p>While the end result of <code>shift()</code> will be valid, an
intermediate state is not. The easiest way to resolve this problem is to
set the properties all at once:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">shift</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">shift</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/props.html">props</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    start <span class="op">=</span> <span class="va">x</span><span class="op">@</span><span class="va">start</span> <span class="op">+</span> <span class="va">shift</span>,</span>
<span>    end <span class="op">=</span> <span class="va">x</span><span class="op">@</span><span class="va">end</span> <span class="op">+</span> <span class="va">shift</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">x</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">shift</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span><span class="op">)</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;range&gt;</span></span>
<span><span class="co">#&gt;  @ start: num 11</span></span>
<span><span class="co">#&gt;  @ end  : num 20</span></span></code></pre></div>
<p>The object is still validated, but it’s only validated once, after
all the properties have been modified.</p>
</div>
</div>
<div class="section level2">
<h2 id="properties">Properties<a class="anchor" aria-label="anchor" href="#properties"></a>
</h2>
<p>So far we’ve focused on the simplest form of property specification
where you use a named list to supply the desired type for each property.
This is a convenient shorthand for a call to
<code><a href="../reference/new_property.html">new_property()</a></code>. For example, the property definition of
range above is shorthand for:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">range</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_class.html">new_class</a></span><span class="op">(</span><span class="st">"range"</span>,</span>
<span>  properties <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    start <span class="op">=</span> <span class="fu"><a href="../reference/new_property.html">new_property</a></span><span class="op">(</span><span class="va">class_double</span><span class="op">)</span>,</span>
<span>    end <span class="op">=</span> <span class="fu"><a href="../reference/new_property.html">new_property</a></span><span class="op">(</span><span class="va">class_double</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Calling <code><a href="../reference/new_property.html">new_property()</a></code> explicitly allows you to control
aspects of the property other than its type. The following sections show
you how to provide a default value, compute the property value on
demand, or provide a fully dynamic property.</p>
<div class="section level3">
<h3 id="default-value">Default value<a class="anchor" aria-label="anchor" href="#default-value"></a>
</h3>
<p>The defaults of <code><a href="../reference/new_class.html">new_class()</a></code> create an class that can be
constructed with no arguments:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">empty</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_class.html">new_class</a></span><span class="op">(</span><span class="st">"empty"</span>,</span>
<span>  properties <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">class_double</span>,</span>
<span>    y <span class="op">=</span> <span class="va">class_character</span>,</span>
<span>    z <span class="op">=</span> <span class="va">class_logical</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">empty</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;empty&gt;</span></span>
<span><span class="co">#&gt;  @ x: num(0) </span></span>
<span><span class="co">#&gt;  @ y: chr(0) </span></span>
<span><span class="co">#&gt;  @ z: logi(0)</span></span></code></pre></div>
<p>The default values of the properties will be filled in with “empty”
instances. You can instead provide your own defaults by using the
<code>default</code> argument:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">empty</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_class.html">new_class</a></span><span class="op">(</span><span class="st">"empty"</span>,</span>
<span>  properties <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="fu"><a href="../reference/new_property.html">new_property</a></span><span class="op">(</span><span class="va">class_numeric</span>, default <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>    y <span class="op">=</span> <span class="fu"><a href="../reference/new_property.html">new_property</a></span><span class="op">(</span><span class="va">class_character</span>, default <span class="op">=</span> <span class="st">""</span><span class="op">)</span>,</span>
<span>    z <span class="op">=</span> <span class="fu"><a href="../reference/new_property.html">new_property</a></span><span class="op">(</span><span class="va">class_logical</span>, default <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">empty</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;empty&gt;</span></span>
<span><span class="co">#&gt;  @ x: num 0</span></span>
<span><span class="co">#&gt;  @ y: chr ""</span></span>
<span><span class="co">#&gt;  @ z: logi NA</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="computed-properties">Computed properties<a class="anchor" aria-label="anchor" href="#computed-properties"></a>
</h3>
<p>It’s sometimes useful to have a property that is computed on demand.
For example, it’d be convenient to pretend that our range has a length,
which is just the distance between <code>@start</code> and
<code>@end</code>. You can dynamically compute the value of a property
by defining a <code>getter</code>:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">range</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_class.html">new_class</a></span><span class="op">(</span><span class="st">"range"</span>,</span>
<span>  properties <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    start <span class="op">=</span> <span class="va">class_double</span>,</span>
<span>    end <span class="op">=</span> <span class="va">class_double</span>,</span>
<span>    length <span class="op">=</span> <span class="fu"><a href="../reference/new_property.html">new_property</a></span><span class="op">(</span></span>
<span>      getter <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">self</span><span class="op">)</span> <span class="va">self</span><span class="op">@</span><span class="va">end</span> <span class="op">-</span> <span class="va">self</span><span class="op">@</span><span class="va">start</span>,</span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span>start <span class="op">=</span> <span class="fl">1</span>, end <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">x</span></span>
<span><span class="co">#&gt; &lt;range&gt;</span></span>
<span><span class="co">#&gt;  @ start : num 1</span></span>
<span><span class="co">#&gt;  @ end   : num 10</span></span>
<span><span class="co">#&gt;  @ length: num 9</span></span></code></pre></div>
<p>Computed properties are read-only:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">@</span><span class="va">length</span> <span class="op">&lt;-</span> <span class="fl">20</span></span>
<span><span class="co">#&gt; Error: Can't set read-only property &lt;range&gt;@length</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="dynamic-properties">Dynamic properties<a class="anchor" aria-label="anchor" href="#dynamic-properties"></a>
</h3>
<p>You can make a computed property fully dynamic so that it can be read
and written by also supplying a <code>setter</code>. For example, we
could extend the previous example to allow the <code>@length</code> to
be set, by modifying the <code>@end</code> of the vector:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">range</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_class.html">new_class</a></span><span class="op">(</span><span class="st">"range"</span>,</span>
<span>  properties <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    start <span class="op">=</span> <span class="va">class_double</span>,</span>
<span>    end <span class="op">=</span> <span class="va">class_double</span>,</span>
<span>    length <span class="op">=</span> <span class="fu"><a href="../reference/new_property.html">new_property</a></span><span class="op">(</span></span>
<span>      class <span class="op">=</span> <span class="va">class_double</span>,</span>
<span>      getter <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">self</span><span class="op">)</span> <span class="va">self</span><span class="op">@</span><span class="va">end</span> <span class="op">-</span> <span class="va">self</span><span class="op">@</span><span class="va">start</span>,</span>
<span>      setter <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">self</span>, <span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">self</span><span class="op">@</span><span class="va">end</span> <span class="op">&lt;-</span> <span class="va">self</span><span class="op">@</span><span class="va">start</span> <span class="op">+</span> <span class="va">value</span></span>
<span>        <span class="va">self</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span>start <span class="op">=</span> <span class="fl">1</span>, end <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">x</span></span>
<span><span class="co">#&gt; &lt;range&gt;</span></span>
<span><span class="co">#&gt;  @ start : num 1</span></span>
<span><span class="co">#&gt;  @ end   : num 10</span></span>
<span><span class="co">#&gt;  @ length: num 9</span></span>
<span></span>
<span><span class="va">x</span><span class="op">@</span><span class="va">length</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="va">x</span></span>
<span><span class="co">#&gt; &lt;range&gt;</span></span>
<span><span class="co">#&gt;  @ start : num 1</span></span>
<span><span class="co">#&gt;  @ end   : num 6</span></span>
<span><span class="co">#&gt;  @ length: num 5</span></span></code></pre></div>
<p>A <code>setter</code> is a function with arguments <code>self</code>
and <code>value</code> that returns a modified object.</p>
</div>
</div>
<div class="section level2">
<h2 id="constructors">Constructors<a class="anchor" aria-label="anchor" href="#constructors"></a>
</h2>
<p>You can see the source code for a class’s constructor by accessing
the <code>constructor</code> property:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">range</span><span class="op">@</span><span class="va">constructor</span></span>
<span><span class="co">#&gt; function (start = class_missing, end = class_missing) </span></span>
<span><span class="co">#&gt; new_object(S7_object(), start = start, end = end)</span></span>
<span><span class="co">#&gt; &lt;environment: namespace:S7&gt;</span></span></code></pre></div>
<p>In most cases, S7’s default constructor will all you need. However,
in some cases you might want something custom. For example, for our
range class, maybe we’d like to construct it from a vector of numeric
values, automatically computing the min and the max. To implement this
we could do:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">range</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_class.html">new_class</a></span><span class="op">(</span><span class="st">"range"</span>,</span>
<span>  properties <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    start <span class="op">=</span> <span class="va">class_numeric</span>,</span>
<span>    end <span class="op">=</span> <span class="va">class_numeric</span></span>
<span>  <span class="op">)</span>,</span>
<span>  constructor <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="../reference/new_class.html">new_object</a></span><span class="op">(</span><span class="fu"><a href="../reference/S7_object.html">S7_object</a></span><span class="op">(</span><span class="op">)</span>, start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, end <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">5</span>, <span class="fl">0</span>, <span class="fl">2</span>, <span class="fl">5</span>, <span class="fl">7</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;range&gt;</span></span>
<span><span class="co">#&gt;  @ start: num 0</span></span>
<span><span class="co">#&gt;  @ end  : num 10</span></span></code></pre></div>
<p>A constructor must always end with a call to
<code><a href="../reference/new_class.html">new_object()</a></code>. The first argument to
<code><a href="../reference/new_class.html">new_object()</a></code> should be an object of the <code>parent</code>
class (if you haven’t specified a <code>parent</code> argument to
<code><a href="../reference/new_class.html">new_class()</a></code>, then you should use <code><a href="../reference/S7_object.html">S7_object()</a></code>
as the parent here). That argument should be followed by one named
argument for each property.</p>
<p>There’s one drawback of custom constructors that you should be aware:
any subclass will also require a custom constructor.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Davis Vaughan, Jim Hester, Tomasz Kalinowski, Will Landau, Michael Lawrence, Martin Maechler, Luke Tierney, Hadley Wickham.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
