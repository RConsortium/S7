<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Generics and methods • S7</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Generics and methods">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">S7</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/S7.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/generics-methods.html">Generics and methods</a></li>
    <li><a class="dropdown-item" href="../articles/classes-objects.html">Classes and objects</a></li>
    <li><a class="dropdown-item" href="../articles/compatibility.html">Compatibility with S3 and S4</a></li>
    <li><a class="dropdown-item" href="../articles/packages.html">Using S7 in a package</a></li>
    <li><a class="dropdown-item" href="../articles/motivation.html">Motivation for S7</a></li>
    <li><a class="dropdown-item" href="../articles/performance.html">Performance</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news">
<li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2024/11/s7-0-2-0/">S7 0.2.0</a></li>
    <li><a class="external-link dropdown-item" href="https://blog.r-project.org/2024/05/17/generalizing-support-for-functional-oop-in-r/index.html">S7 0.1.0</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/RConsortium/S7/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Generics and methods</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/RConsortium/S7/blob/main/vignettes/generics-methods.Rmd" class="external-link"><code>vignettes/generics-methods.Rmd</code></a></small>
      <div class="d-none name"><code>generics-methods.Rmd</code></div>
    </div>

    
    
<p>This vignette dives into the details of S7 generics and method
dispatch, building on the basics discussed in
<code><a href="../articles/S7.html">vignette("S7")</a></code>. We’ll first introduce the concept of
generic-method compatibility, then discuss some of the finer details of
creating a generic with <code><a href="../reference/new_generic.html">new_generic()</a></code>. This vignette first
discusses generic-method compatibility, and you might want to customize
the body of the generic, and generics that live in suggested packages.
We’ll then pivot to talk more details of method dispatch including
<code><a href="../reference/super.html">super()</a></code> and multiple dispatch.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rconsortium.github.io/S7/">S7</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="generic-method-compatibility">Generic-method compatibility<a class="anchor" aria-label="anchor" href="#generic-method-compatibility"></a>
</h2>
<p>When you register a method, S7 checks that your method is compatible
with the generic.</p>
<p>The formal arguments of the generic and methods must agree. This
means that:</p>
<ul>
<li>Any arguments that the generic has, the method must have too. In
particular, the arguments of the method start with the arguments that
the generic dispatches on, and those arguments must not have default
arguments.</li>
<li>The method can contain arguments that the generic does not, as long
as the generic includes <code>…</code> in the argument list.</li>
</ul>
<div class="section level3">
<h3 id="generic-with-dots-method-without-dots">Generic with dots; method without dots<a class="anchor" aria-label="anchor" href="#generic-with-dots-method-without-dots"></a>
</h3>
<p>The default generic includes <code>…</code> but generally the methods
should not. That ensures that misspelled arguments won’t be silently
swallowed by the method. This is an important difference from S3. Take a
very simple implementation of <code><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean()</a></code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_generic.html">new_generic</a></span><span class="op">(</span><span class="st">"mean"</span>, <span class="st">"x"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/method.html">method</a></span><span class="op">(</span><span class="va">mean</span>, <span class="va">class_numeric</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></code></pre></div>
<p>If we pass an additional argument in, we’ll get an error:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fl">100</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>But we can still add additional arguments if we desired:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/method.html">method</a></span><span class="op">(</span><span class="va">mean</span>, <span class="va">class_numeric</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">na.rm</span> <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">na.rm</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; Overwriting method mean(&lt;integer&gt;)</span></span>
<span><span class="co">#&gt; Overwriting method mean(&lt;double&gt;)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="cn">NA</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 100</span></span></code></pre></div>
<p>(We’ll come back to the case of requiring that all methods implement
a <code>na.rm = TRUE</code> argument shortly.)</p>
</div>
<div class="section level3">
<h3 id="generic-and-method-with-dots">Generic and method with dots<a class="anchor" aria-label="anchor" href="#generic-and-method-with-dots"></a>
</h3>
<p>There are cases where you do need to take <code>…</code> in a method,
which is particularly problematic if you need to re-call the generic
recursively. For example, imagine a simple print method like this:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">simple_print</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_generic.html">new_generic</a></span><span class="op">(</span><span class="st">"simple_print"</span>, <span class="st">"x"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/method.html">method</a></span><span class="op">(</span><span class="va">simple_print</span>, <span class="va">class_double</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">digits</span> <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">{</span><span class="op">}</span></span>
<span><span class="fu"><a href="../reference/method.html">method</a></span><span class="op">(</span><span class="va">simple_print</span>, <span class="va">class_character</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">max_length</span> <span class="op">=</span> <span class="fl">100</span><span class="op">)</span> <span class="op">{</span><span class="op">}</span></span></code></pre></div>
<p>What if you want to print a list?</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/method.html">method</a></span><span class="op">(</span><span class="va">simple_print</span>, <span class="va">class_list</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">el</span> <span class="kw">in</span> <span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">simple_print</span><span class="op">(</span><span class="va">el</span>, <span class="va">...</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>It’s fine as long as all the elements of the list are numbers, but as
soon as we add a character vector, we get an error:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">simple_print</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu">simple_print</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="st">"x"</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p>To solve this situation, methods generally need to ignore arguments
that they haven’t been specifically designed to handle, i.e. they need
to use <code>…</code>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/method.html">method</a></span><span class="op">(</span><span class="va">simple_print</span>, <span class="va">class_double</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span>, <span class="va">digits</span> <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">{</span><span class="op">}</span></span>
<span><span class="co">#&gt; Overwriting method simple_print(&lt;double&gt;)</span></span>
<span><span class="fu"><a href="../reference/method.html">method</a></span><span class="op">(</span><span class="va">simple_print</span>, <span class="va">class_character</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span>, <span class="va">max_length</span> <span class="op">=</span> <span class="fl">100</span><span class="op">)</span> <span class="op">{</span><span class="op">}</span></span>
<span><span class="co">#&gt; Overwriting method simple_print(&lt;character&gt;)</span></span>
<span></span>
<span><span class="fu">simple_print</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="st">"x"</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p>In this case we really do want to silently ignore unknown arguments
because they might apply to other methods. There’s unfortunately no easy
way to avoid this problem without relying on fairly esoteric technology
(as done by <code><a href="https://rlang.r-lib.org/reference/check_dots_used.html" class="external-link">rlang::check_dots_used()</a></code>).</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">simple_print</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="st">"x"</span><span class="op">)</span>, diggits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="generic-and-method-without-dots">Generic and method without dots<a class="anchor" aria-label="anchor" href="#generic-and-method-without-dots"></a>
</h3>
<p>Occasional it’s useful to create a generic without <code>…</code>
because such functions have a useful property: if a call succeeds for
one type of input, it will succeed for any type of input. To create such
a generic, you’ll need to use the third argument to
<code><a href="../reference/new_generic.html">new_generic()</a></code>: an optional function that powers the
generic. This function has one key property: it must call
<code><a href="../reference/new_generic.html">S7_dispatch()</a></code> to actually perform dispatch.</p>
<p>In general, this property is only needed for very low-level functions
with precisely defined semantics. A good example of such a function is
<code><a href="https://rdrr.io/r/base/length.html" class="external-link">length()</a></code>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">length</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_generic.html">new_generic</a></span><span class="op">(</span><span class="st">"length"</span>, <span class="st">"x"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/new_generic.html">S7_dispatch</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>Omitting <code>…</code> from the generic signature is a strong
restriction as it prevents methods from adding extra arguments. For this
reason, it should only be used in special situations.</p>
</div>
</div>
<div class="section level2">
<h2 id="customizing-generics">Customizing generics<a class="anchor" aria-label="anchor" href="#customizing-generics"></a>
</h2>
<p>In most cases, you’ll supply the first two arguments to
<code><a href="../reference/new_generic.html">new_generic()</a></code> and allow it to automatically generate the
body of the generic:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">display</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_generic.html">new_generic</a></span><span class="op">(</span><span class="st">"display"</span>, <span class="st">"x"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/S7_data.html">S7_data</a></span><span class="op">(</span><span class="va">display</span><span class="op">)</span></span>
<span><span class="co">#&gt; function (x, ...) </span></span>
<span><span class="co">#&gt; S7::S7_dispatch()</span></span></code></pre></div>
<p>The most important part of the body is <code><a href="../reference/new_generic.html">S7_dispatch()</a></code>;
this function finds the method that matches the arguments used for
dispatch and calls it with the arguments supplied to the generic.</p>
<p>It can be useful to customize this body. The previous section showed
one case when you might want to supply the body yourself: dropping
<code>…</code> from the formals of the generic. There are three other
useful cases:</p>
<ul>
<li>To add required arguments.</li>
<li>To add optional arguments.</li>
<li>Perform some standard work.</li>
</ul>
<p>A custom <code>fun</code> must always include a call to
<code><a href="../reference/new_generic.html">S7_dispatch()</a></code>, which will usually be the last call.</p>
<div class="section level3">
<h3 id="add-required-arguments">Add required arguments<a class="anchor" aria-label="anchor" href="#add-required-arguments"></a>
</h3>
<p>To add required arguments that aren’t dispatched upon, you just need
to add additional arguments that lack default values:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">foo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_generic.html">new_generic</a></span><span class="op">(</span><span class="st">"foo"</span>, <span class="st">"x"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/new_generic.html">S7_dispatch</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>Now all methods will need to provide that <code>y</code> argument. If
not, you’ll get a warning:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/method.html">method</a></span><span class="op">(</span><span class="va">foo</span>, <span class="va">class_integer</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fl">10</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; Warning: foo(&lt;integer&gt;) doesn't have argument `y`</span></span></code></pre></div>
<p>This is a warning, not an error, because the generic might be defined
in a different package and is in the process of changing interfaces.
You’ll always want to address this warning when you see it.</p>
</div>
<div class="section level3">
<h3 id="add-optional-arguments">Add optional arguments<a class="anchor" aria-label="anchor" href="#add-optional-arguments"></a>
</h3>
<p>Adding an optional argument is similar, but it should generally come
after <code>…</code>. This ensures that the user must supply the full
name of the argument when calling the function, which makes it easier to
extend your function in the future.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_generic.html">new_generic</a></span><span class="op">(</span><span class="st">"mean"</span>, <span class="st">"x"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span>, <span class="va">na.rm</span> <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/new_generic.html">S7_dispatch</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/method.html">method</a></span><span class="op">(</span><span class="va">mean</span>, <span class="va">class_integer</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">na.rm</span> <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">na.rm</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Forgetting the argument or using a different default value will again
generate a warning.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/method.html">method</a></span><span class="op">(</span><span class="va">mean</span>, <span class="va">class_double</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">na.rm</span> <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span><span class="op">}</span></span>
<span><span class="co">#&gt; Warning: In mean(&lt;double&gt;), default value of `na.rm` is not the same as the generic</span></span>
<span><span class="co">#&gt; - Generic: TRUE</span></span>
<span><span class="co">#&gt; - Method:  FALSE</span></span>
<span><span class="fu"><a href="../reference/method.html">method</a></span><span class="op">(</span><span class="va">mean</span>, <span class="va">class_logical</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span><span class="op">}</span></span>
<span><span class="co">#&gt; Warning: mean(&lt;logical&gt;) doesn't have argument `na.rm`</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="do-some-work">Do some work<a class="anchor" aria-label="anchor" href="#do-some-work"></a>
</h3>
<p>If your generic has additional arguments, you might want to do some
additional work to verify that they’re of the expected type. For
example, our <code><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean()</a></code> function could verify that
<code>na.rm</code> was correctly specified:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_generic.html">new_generic</a></span><span class="op">(</span><span class="st">"mean"</span>, <span class="st">"x"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span>, <span class="va">na.rm</span> <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="va">na.rm</span>, <span class="cn">TRUE</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span>na.rm <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"`na.rm` must be either TRUE or FALSE"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu"><a href="../reference/new_generic.html">S7_dispatch</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>The only downside to performing error checking is that you constraint
the interface for all methods; if for some reason a method found it
useful to allow <code>na.rm</code> to be a number or a string, it would
have to provide an alternative argument.</p>
</div>
</div>
<div class="section level2">
<h2 id="super">
<code>super()</code><a class="anchor" aria-label="anchor" href="#super"></a>
</h2>
<p>Sometimes it’s useful to define a method for a class that relies on
the implementation for its superclass. A good example of this is
computing the mean of a date — since dates represent the number of days
since 1970-01-01, computing the mean is just a matter of computing the
mean of the underlying numeric vector and converting it back to a
date.</p>
<p>To demonstrate this idea, I’ll first define a mean generic with a
method for numbers:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_generic.html">new_generic</a></span><span class="op">(</span><span class="st">"mean"</span>, <span class="st">"x"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/method.html">method</a></span><span class="op">(</span><span class="va">mean</span>, <span class="va">class_numeric</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 5.5</span></span></code></pre></div>
<p>And a Date class:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">date</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_class.html">new_class</a></span><span class="op">(</span><span class="st">"date"</span>, parent <span class="op">=</span> <span class="va">class_double</span><span class="op">)</span></span>
<span><span class="co"># Cheat by using the existing base .Date class</span></span>
<span><span class="fu"><a href="../reference/method.html">method</a></span><span class="op">(</span><span class="va">print</span>, <span class="va">date</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/base-internal.html" class="external-link">.Date</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/date.html" class="external-link">date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span>, <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "1970-01-02" "1970-01-11" "1970-04-11"</span></span></code></pre></div>
<p>Now to compute a mean we write:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/method.html">method</a></span><span class="op">(</span><span class="va">mean</span>, <span class="va">date</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/date.html" class="external-link">date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="../reference/super.html">super</a></span><span class="op">(</span><span class="va">x</span>, to <span class="op">=</span> <span class="va">class_double</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/date.html" class="external-link">date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span>, <span class="fl">100</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "1970-02-07"</span></span></code></pre></div>
<p>Let’s unpack this method from the inside out:</p>
<ol style="list-style-type: decimal">
<li>First we call <code>super(x, to = class_double)</code> — this will
make the call to next generic treat <code>x</code> like it’s a double,
rather than a date.</li>
<li>Then we call <code><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean()</a></code> which because of
<code><a href="../reference/super.html">super()</a></code> will call the <code><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean()</a></code> method we defined
above.</li>
<li>Finally, we take the number returned by mean and convert it back to
a date.</li>
</ol>
<p>If you’re very familiar with S3 or S4 you might recognize that
<code><a href="../reference/super.html">super()</a></code> fills a similar role to <code><a href="https://rdrr.io/r/base/UseMethod.html" class="external-link">NextMethod()</a></code>
or <code>callNextMethod()</code>. However, it’s much more explicit: you
need to supply the name of the parent class, the generic to use, and all
the arguments to the generic. This explicitness makes the code easier to
understand and will eventually enable certain performance optimizations
that would otherwise be very difficult.</p>
</div>
<div class="section level2">
<h2 id="multiple-dispatch">Multiple dispatch<a class="anchor" aria-label="anchor" href="#multiple-dispatch"></a>
</h2>
<p>So far we have focused primarily on single dispatch, i.e. generics
where <code>dispatch_args</code> is a single string. It is also possible
to supply a length 2 (or more!) vector <code>dispatch_args</code> to
create a generic that performs multiple dispatch, i.e. it uses the
classes of more than one object to find the appropriate method.</p>
<p>Multiple dispatch is a feature primarily of S4, although S3 includes
some limited special cases for arithmetic operators. Multiple dispatch
is heavily used in S4; we don’t expect it to be heavily used in S7, but
it is occasionally useful.</p>
<div class="section level3">
<h3 id="a-simple-example">A simple example<a class="anchor" aria-label="anchor" href="#a-simple-example"></a>
</h3>
<p>Let’s take our speak example from <code><a href="../articles/S7.html">vignette("S7")</a></code> and
extend it to teach our pets how to speak multiple languages:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Pet</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_class.html">new_class</a></span><span class="op">(</span><span class="st">"Pet"</span><span class="op">)</span></span>
<span><span class="va">Dog</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_class.html">new_class</a></span><span class="op">(</span><span class="st">"Dog"</span>, <span class="va">Pet</span><span class="op">)</span></span>
<span><span class="va">Cat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_class.html">new_class</a></span><span class="op">(</span><span class="st">"Cat"</span>, <span class="va">Pet</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Language</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_class.html">new_class</a></span><span class="op">(</span><span class="st">"Language"</span><span class="op">)</span></span>
<span><span class="va">English</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_class.html">new_class</a></span><span class="op">(</span><span class="st">"English"</span>, <span class="va">Language</span><span class="op">)</span></span>
<span><span class="va">French</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_class.html">new_class</a></span><span class="op">(</span><span class="st">"French"</span>, <span class="va">Language</span><span class="op">)</span></span>
<span></span>
<span><span class="va">speak</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/new_generic.html">new_generic</a></span><span class="op">(</span><span class="st">"speak"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/method.html">method</a></span><span class="op">(</span><span class="va">speak</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">Dog</span>, <span class="va">English</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="st">"Woof"</span></span>
<span><span class="fu"><a href="../reference/method.html">method</a></span><span class="op">(</span><span class="va">speak</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">Cat</span>, <span class="va">English</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="st">"Meow"</span></span>
<span><span class="fu"><a href="../reference/method.html">method</a></span><span class="op">(</span><span class="va">speak</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">Dog</span>, <span class="va">French</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="st">"Ouaf Ouaf"</span></span>
<span><span class="fu"><a href="../reference/method.html">method</a></span><span class="op">(</span><span class="va">speak</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">Cat</span>, <span class="va">French</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="st">"Miaou"</span></span>
<span></span>
<span><span class="fu">speak</span><span class="op">(</span><span class="fu">Cat</span><span class="op">(</span><span class="op">)</span>, <span class="fu">English</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Meow"</span></span>
<span><span class="fu">speak</span><span class="op">(</span><span class="fu">Dog</span><span class="op">(</span><span class="op">)</span>, <span class="fu">French</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Ouaf Ouaf"</span></span>
<span></span>
<span><span class="co"># This example was originally inspired by blog.klipse.tech/javascript/2021/10/03/multimethod.html</span></span>
<span><span class="co"># which has unfortunately since disappeared.</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="special-classes">Special “classes”<a class="anchor" aria-label="anchor" href="#special-classes"></a>
</h3>
<p>There are two special classes that become particularly useful with
multiple dispatch:</p>
<ul>
<li>
<code><a href="../reference/class_any.html">class_any()</a></code> will match any class</li>
<li>
<code><a href="../reference/class_missing.html">class_missing()</a></code> will match a missing argument (i.e. not
<code>NA</code>, but an argument that was not supplied)</li>
</ul>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Davis Vaughan, Jim Hester, Tomasz Kalinowski, Will Landau, Michael Lawrence, Martin Maechler, Luke Tierney, Hadley Wickham.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
